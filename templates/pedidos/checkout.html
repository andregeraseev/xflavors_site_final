{% extends 'base.html' %}

{% block content %}
<div class="row">
  <div class="col-md-8">
    <h2>Itens do Carrinho</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Quantidade</th>
          <th>Preço unitário</th>
          <th>Preço total</th>
        </tr>
      </thead>
      <tbody>
        {% for item in itens %}
        <tr>
          <td>{{ item.product.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>R$ {{ item.product.price }}</td>
          <td>R$ {{ item.total_price }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th colspan="3">Total</th>
          <td>R$ {{ total }}</td>
        </tr>
      </tfoot>
    </table>
  </div>
  <div class="col-md-4">
 <h2>Endereço de Entrega</h2>
    {% if endereco_primario %}
    <p>{{ endereco_primario.rua }}, {{ endereco_primario.numero }} - {{ endereco_primario.complemento }}<br>{{ endereco_primario.bairro }}, {{ endereco_primario.cidade }} - {{ endereco_primario.estado }}<br>CEP: {{ endereco_primario.cep }}</p>

<button id="editar-endereco" data-endereco-id="{{ endereco_primario.id }}">Alterar Endereço</button><div id="editar-endereco-container" data-endereco-id="{{ endereco_primario.id }}"></div>
    <h4>Outros endereços: </h4>
    <select name="endereco_entrega" id="endereco_entrega">
  <option  selected>selecio um novo endereco</option>
  {% for e in endereco %}
  <option value="{{ e.id }}">{{ e.rua }}, {{ e.numero }} - {{ e.complemento }} {{ e.bairro }}, {{ e.cidade }} - {{ e.estado }} CEP: {{ e.cep }}</option>
  {% endfor %}
</select>
    {% else %}
    <p>Você não tem um endereço de entrega cadastrado.</p>
    <a href="">Adicionar Endereço</a>#criar endereco de entrega
    {% endif %}

    <h2>Formas de Pagamento</h2>
    <form action="{% url 'processar_pagamento' %}" method="POST">
      {% csrf_token %}
      <div class="form-check">
        <input type="radio" name="metodo_pagamento" id="pagamento-cartao" value="cartao" class="form-check-input" checked>
        <label for="pagamento-cartao" class="form-check-label">Cartão de crédito</label>
      </div>
      <div class="form-check">
        <input type="radio" name="metodo_pagamento" id="pagamento-pix" value="pix" class="form-check-input">
        <label for="pagamento-pix" class="form-check-label">Pix</label>
      </div>
      <div class="form-check">
        <input type="radio" name="metodo_pagamento" id="pagamento-deposito" value="deposito" class="form-check-input">
        <label for="pagamento-deposito" class="form-check-label">Depósito Bancário</label>
      </div>
      <button type="submit" class="btn btn-primary">Finalizar Pedido</button>
    </form>
  </div>
</div>



<script>
$(document).ready(function() {
  $('#endereco_entrega').on('change', function() {
    // Obter o ID do endereço selecionado
    var enderecoId = $(this).val();

    // Enviar uma solicitação AJAX para atualizar o endereço de entrega
    $.ajax({
      url: '{% url "atualizar_endereco_entrega" %}',
      type: 'POST',
      data: {
        'endereco_id': enderecoId,
        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
      },
      success: function() {
        // Atualizar a página para exibir o novo endereço selecionado
        location.reload();
      }
    });
  });
});




$(document).ready(function() {
  // Enviar solicitação AJAX para exibir o formulário de edição do endereço
  $('#editar-endereco').on('click', function() {
    var enderecoId = $(this).data('endereco-id');
    $.ajax({
      url: '{% url "editar_endereco" %}',
      type: 'GET',
      data: {
        'endereco_id': enderecoId,
      },
      success: function(response) {
        $('#editar-endereco-container').html(response);
      }
    });
  });
});
</script>



{% endblock %}