<!-- products/product_detail.html -->

{% extends 'base.html' %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <h1>{{ product.name }}</h1>
        <div class="col-6">
            <img src="{{ product.image.url }}" alt="{{ product.name }}" style="max-width: 400px;">
        </div>
        <div class="col-6">
            <h4>Descrição:</h4>
            <h5>{{ product.description }}</h5>
            {% if product.variation_set.exists %}
                <h4>Selecione uma variação:</h4>
                <select name="variation" id="variation">
                    {% for variation in product.variation_set.all %}
                        <option value="{{ variation.id }}">{{ variation.name }} - R$ {{ variation.price }}</option>
                    {% endfor %}
                </select>
                <h5 id="price">R$ {{ product.variation_set.first.price }}</h5>
            {% else %}
                <h5 id="price">R$ {{ product.price }}</h5>
            {% endif %}
            <input type="number" id="quantity" name="quantity" value="1">
            <button type="button" class="btn btn-primary" id="add_to_cart_button">Adicionar ao carrinho</button>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('#variation').change(function () {
            var selectedVariationId = $(this).val();
            var selectedVariationPrice = $('#variation option[value=' + selectedVariationId + ']').text().split(" - R$ ")[1];
            $('#price').text('R$ ' + selectedVariationPrice);
        });
    });
</script>




<script>
    $(document).ready(function () {
        $('#add_to_cart_button').click(function () {
            let quantity = $('#quantity').val();
            let variation = $('#variation').val();
            let url = '{% url 'cart:add_to_cart' product.id %}';
            $.ajax({
                type: 'POST',
                url: url,
                data: {'quantity': quantity, 'variation': variation, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
                dataType: 'json',
                success: function (data) {
                    if (data.success) {
                        $('#cart-icon').load(document.URL +  ' #cart-icon');
                        $('#alert_success').show(); // Mostra a mensagem de sucesso
                        $('#alert_container_success').show(); // Mostra o container da mensagem de sucesso
                        $('#alert_success').html( data.produto_adicionado); // Adiciona o nome do produto e da variação na mensagem de sucesso
                        setTimeout(function() { // Configura um temporizador
                            $('#alert_success').hide(); // Oculta a mensagem de sucesso após 5 segundos
                            $('#alert_container_success').hide(); // Oculta o container da mensagem de sucesso após 5 segundos
                        }, 5000);
                    } else {
                        $('#alert-erro').show(); // Mostra a mensagem de erro
                        $('#alert-container-erro').show(); // Mostra o container da mensagem de erro
                        $('#alert-erro').html( data.error); // Adiciona uma mensagem de estoque insuficiente

                        setTimeout(function() { // Configura um temporizador
                            $('#alert-erro').hide(); // Oculta a mensagem de erro após 5 segundos
                            $('#alert-container-erro').hide(); // Oculta o container da mensagem de erro após 5 segundos
                        }, 5000);
                    }
                },
                error: function (data) {
                    alert(' Ocorreu um erro ao adicionar o produto ao carrinho. Tente novamente mais tarde. + data.error');
                }
            });
        });
    });
</script>



{% endblock %}